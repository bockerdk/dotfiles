#!/usr/bin/env bash

# Check if command is availble
check_cmd () {
    if command -v $1 &>/dev/null; then
        echo -e "  $1: ok";
    else
        echo -e "  $1: not found";
    fi
}

# Script must be run from inside it's directory
if [ ! -f "$(basename "$0")" ]; then
    echo "Script must be run from inside it's directory"
    exit 1
fi

# Set config directory
if [[ -z "${XDG_CONFIG_HOME}" ]]; then
    config_dir="$HOME/.config"
else
    config_dir="${XDG_CONFIG_HOME}"
fi
# Set bin directory
bin_dir="$HOME/.local/bin"
# Set font directory
font_dir="$HOME/.local/share/fonts"
# Set wallpaper directory
wallpaper_dir="$HOME/.local/share/wallpapers"

# Create config directory if missing
mkdir -p $config_dir
# Create bin directory if missing
mkdir -p $bin_dir
# Create font directory if missing
mkdir -p $font_dir
# Create wallpaper directory if missing
mkdir -p $wallpaper_dir

# Resources
echo "Installing resources"
## Fonts
echo -e "  fonts"
cp $PWD/res/fonts/* $font_dir
## Wallpaper
echo -e "  wallpapers"
cp $PWD/res/wallpapers/* $wallpaper_dir

# Foot
echo "Installing foot"
check_cmd foot
ln -snf $PWD/foot $config_dir/

# Bash
echo "Installing bash"
check_cmd bash
ln -snf $PWD/bash/.bash_profile $HOME/
ln -snf $PWD/bash/.bashrc $HOME/

# Git
echo "Installing git"
check_cmd git
ln -snf $PWD/git $config_dir/

# Neovim
echo "Installing neovim"
check_cmd nvim
ln -snf $PWD/nvim $config_dir/

# Sway
echo "Installing sway"
check_cmd sway
check_cmd swayidle
check_cmd swaylock
check_cmd swaybg
check_cmd wmenu
ln -snf $PWD/sway $config_dir/

# Tmux
echo "Installing tmux"
check_cmd tmux
ln -snf $PWD/tmux $config_dir/
ln -snf $PWD/tmux/txs $HOME/.local/bin/

# Emacs
# echo "Installing emacs"
# ln -snf $PWD/emacs $config_dir/

# GDB
echo "Installing gdb"
check_cmd gdb
ln -snf $PWD/gdb $config_dir/

# Mail
## Deps:
##      mbsync
##      msmtp
##      notmuch
##      systemd file

# Optional utilities
echo "Checking for optional utilities"
check_cmd jq
